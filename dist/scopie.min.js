var g=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var k=Object.getOwnPropertyNames;var x=Object.prototype.hasOwnProperty;var m=(r,t)=>{for(var n in t)g(r,n,{get:t[n],enumerable:!0})},A=(r,t,n,e)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of k(t))!x.call(r,i)&&i!==n&&g(r,i,{get:()=>t[i],enumerable:!(e=y(t,i))||e.enumerable});return r};var $=r=>A(g({},"__esModule",{value:!0}),r);var j={};m(j,{arraySeperator:()=>w,blockSeperator:()=>a,isAllowed:()=>I,validateScope:()=>M,varPrefix:()=>u,wildcard:()=>s});module.exports=$(j);var w="|",a="/",s="*",u="@";function b(r){return r>="a"&&r<="z"||r>="A"&&r<="Z"||r>="0"&&r<="9"?!0:r==="_"||r==="-"||r===u||r===s}function E(r,t){for(let n=t+1;n<r.length;n+=1)if(r[n]===a||r[n]===w)return n;return r.length}function h(r,t,n){for(let e=n;e<t.length;e+=1){if(t[e]===a)return e;if(t[e]!==w&&!b(t[e]))throw new Error(`scopie-100 in ${r}: invalid character '${t[e]}'`)}return t.length}function B(r,t,n,e,i,c,f){let o=t;if(r[o]===u){let l=r.substring(o+1,n);if(!f.has(l))throw new Error(`scopie-104 in actor: variable '${l}' not found`);return f.get(l)===e.substring(i,c)}if(n-o===1&&r[o]===s)return!0;if(r.substring(o,n).indexOf(w)>=0){for(;o<n;){let l=E(r,o);if(r[o]===u)throw new Error(`scopie-101 in actor: variable '${r.substring(o+1,l)}' found in array block`);if(r[o]===s)throw l-o>1&&r[o+1]===s?new Error("scopie-103 in actor: super wildcard found in array block"):new Error("scopie-102 in actor: wildcard found in array block");if(r.substring(o,l)===e.substring(i,c))return!0;o=l+1}return!1}return r.substring(t,n)===e.substring(i,c)}function O(r,t,n){let e=h("actor",r,0)+1,i=0,c=0,f=0;for(;e<r.length||i<t.length;){if(e<r.length!=i<t.length)return!1;if(c=h("action",t,i),f=h("actor",r,e),f-e===2&&r[e]===s&&r[e+1]===s){if(r.length>f)throw new Error("scopie-105 in actor: super wildcard not in the last block");return!0}if(!B(r,e,f,t,i,c,n))return!1;i=c+1,e=f+1}return!0}function I(r,t,n){if(t.length===0)return!1;if(r.length===0)throw new Error("scopie-106: action scopes was empty");let e;n&&(e=new Map(Object.entries(n)));let i=!1;for(let c=0;c<t.length;c+=1){let f=t[c];if(f.length===0)throw new Error("scopie-106: actor rule was empty");let o=f[0]==="a";if(!(o&&i))for(let l=0;l<r.length;l+=1){let d=r[l];if(d.length===0)throw new Error("scopie-106: action scope was empty");let p=O(f,d,e);if(p&&o)i=!0;else if(p&&!o)return!1}}return i}function M(r){if(r==="")return new Error("scopie-106: scope was empty");let t=!1;for(let n=0;n<r.length;n+=1){if(r[n]===a){t=!1;continue}if(r[n]===w){t=!0;continue}if(t){if(r[n]===s&&n<r.length-1&&r[n+1]===s)return new Error("scopie-103: super wildcard found in array block");if(r[n]===s)return new Error("scopie-102: wildcard found in array block");if(r[n]===u){let e=E(r,n);return new Error(`scopie-101: variable '${r.substring(n+1,e)}' found in array block`)}}if(!b(r[n]))return new Error(`scopie-100: invalid character '${r[n]}'`);if(r[n]===s&&n<r.length-1&&r[n+1]===s&&n<r.length-2)return new Error("scopie-105: super wildcard not in the last block")}}0&&(module.exports={arraySeperator,blockSeperator,isAllowed,validateScope,varPrefix,wildcard});
