(()=>{var O="0.1.0",s=",",b="|",l="/",w="*",g="@";function j(t,n,i){let e;if(t&&(e=new Map(Object.entries(t))),n==="")throw"scopie-106 in scopes@0: scope was empty";if(i==="")throw"scopie-106 in actor@0: scope was empty";let h=!1,f=0,r=0;for(;r<i.length;){let o=i[r]==="a";if(o&&h){r=p(i,r,s);continue}r=p(i,r,l),f=r;let c=0;for(;c<n.length;){let m=A(i,r,n,c,e);if(m.match){r=m.a,c=m.b;let $=r>=i.length||i[r-1]===s,u=c>=n.length||n[c-1]===s;if($&&u){if(o)h=!0,r=p(i,r,s);else return!1;break}else if($!==u)break}else c=p(n,c,s),r=f}r=p(i,r,s)}return h}function A(t,n,i,e,h){if(t[n]===w&&n<t.length-1&&t[n+1]===w){if(n+2<t.length&&t[n+2]!=s)throw`scopie-105 in actor@${n}: super wildcard not in the last block`;return{a:p(t,n,s),b:p(i,e,s),match:!0}}if(t[n]===w)return{a:p(t,n,l),b:p(i,e,l),match:!0};let f=e;for(;f<i.length&&!(i[f]===l||i[f]===s);f++)if(!y(i[f]))throw`scopie-100 in scopes@${f}: invalid character '${i[f]}'`;let r=n,o=n,c=!1;for(;o<t.length;o++){if(t[o]===l||t[o]===s)return k(t,r,o,i,e,f,h)?{a:o+1,b:f+1,match:!0}:{a:n,b:e,match:!1};if(t[o]===b){if(c=!0,t[r]===g)throw`scopie-101 in actor@${r}: variable '${t.substring(r+1,o)}' found in array block`;if(t[r]===w)throw r<t.length-1&&t[r+1]===w?`scopie-103 in actor@${r}: super wildcard found in array block`:`scopie-102 in actor@${r}: wildcard found in array block`;if(k(t,r,o,i,e,f,void 0))return{a:d(t,o),b:f+1,match:!0};r=o+1,o+=1}else if(!y(t[o]))throw`scopie-100 in actor@${o}: invalid character '${t[o]}'`}if(c){if(t[r]===g)throw`scopie-101 in actor@${r}: variable '${t.substring(r+1,o)}' found in array block`;if(t[r]===w)throw r<t.length-1&&t[r+1]===w?`scopie-103 in actor@${r}: super wildcard found in array block`:`scopie-102 in actor@${r}: wildcard found in array block`}return k(t,r,o,i,e,f,h)?{a:o+1,b:f+1,match:!0}:{a:n,b:e,match:!1}}function k(t,n,i,e,h,f,r){if(t[n]===g){let o=t.substring(n+1,i);if(!r.has(o))throw`scopie-104 in actor@${n}: variable '${o}' not found`;return r.get(o)===e.substring(h,f)}return i-n!=f-h?!1:t.substring(n,i)===e.substring(h,f)}function p(t,n,i){for(let e=n+1;e<t.length;e++)if(t[e]===i)return e+1;return t.length}function d(t,n){for(let i=n+1;i<t.length;i++)if(t[i]===l||t[i]===s)return i+1;return t.length}function y(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"||t>="0"&&t<="9"?!0:t==="_"||t==="-"||t===g||t===w}})();
