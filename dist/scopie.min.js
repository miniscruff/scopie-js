var E=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var A=Object.getOwnPropertyNames;var O=Object.prototype.hasOwnProperty;var a=(r,n)=>{for(var t in n)E(r,t,{get:n[t],enumerable:!0})},j=(r,n,t,e)=>{if(n&&typeof n=="object"||typeof n=="function")for(let c of A(n))!O.call(r,c)&&c!==t&&E(r,c,{get:()=>n[c],enumerable:!(e=b(n,c))||e.enumerable});return r};var B=r=>j(E({},"__esModule",{value:!0}),r);var R={};a(R,{arraySeperator:()=>p,blockSeperator:()=>u,isAllowed:()=>F,scopeSeperator:()=>s,validateScope:()=>P,varPrefix:()=>g,wildcard:()=>w});module.exports=B(R);var s=",",p="|",u="/",w="*",g="@";function k(r){return r>="a"&&r<="z"||r>="A"&&r<="Z"||r>="0"&&r<="9"?!0:r==="_"||r==="-"||r===g||r===w}function C(r,n){for(let t=n+1;t<r.length;t+=1)if(r[t]===u||r[t]===s||r[t]===p)return t;return r.length}function h(r,n,t){for(let e=n+1;e<r.length;e+=1)if(r[e]===t)return e+1;return r.length}function M(r,n){for(let t=n+1;t<r.length;t+=1)if(r[t]===u||r[t]===s)return t+1;return r.length}function d(r,n,t,e,c,f,i){if(r[n]===g){let o=r.substring(n+1,t);if(!i.has(o))throw new Error(`scopie-104 in actor@${n}: variable '${o}' not found`);return i.get(o)===e.substring(c,f)}return t-n!==f-c?!1:r.substring(n,t)===e.substring(c,f)}function z(r,n,t,e,c){if(r[n]===w&&n<r.length-1&&r[n+1]===w){if(n+2<r.length&&r[n+2]!==s)throw new Error(`scopie-105 in actor@${n}: super wildcard not in the last block`);return{a:h(r,n,s),b:h(t,e,s),match:!0}}if(r[n]===w)return{a:h(r,n,u),b:h(t,e,u),match:!0};let f=e;for(;f<t.length&&!(t[f]===u||t[f]===s);f+=1)if(!k(t[f]))throw new Error(`scopie-100 in scopes@${f}: invalid character '${t[f]}'`);let i=n,o=n,l=!1;for(;o<r.length;o+=1){if(r[o]===u||r[o]===s)return d(r,i,o,t,e,f,c)?{a:o+1,b:f+1,match:!0}:{a:n,b:e,match:!1};if(r[o]===p){if(l=!0,r[i]===g)throw new Error(`scopie-101 in actor@${i}: variable '${r.substring(i+1,o)}' found in array block`);if(r[i]===w)throw i<r.length-1&&r[i+1]===w?new Error(`scopie-103 in actor@${i}: super wildcard found in array block`):new Error(`scopie-102 in actor@${i}: wildcard found in array block`);if(d(r,i,o,t,e,f,void 0))return{a:M(r,o),b:f+1,match:!0};i=o+1,o+=1}else if(!k(r[o]))throw new Error(`scopie-100 in actor@${o}: invalid character '${r[o]}'`)}if(l){if(r[i]===g)throw new Error(`scopie-101 in actor@${i}: variable '${r.substring(i+1,o)}' found in array block`);if(r[i]===w)throw i<r.length-1&&r[i+1]===w?new Error(`scopie-103 in actor@${i}: super wildcard found in array block`):new Error(`scopie-102 in actor@${i}: wildcard found in array block`)}return d(r,i,o,t,e,f,c)?{a:o+1,b:f+1,match:!0}:{a:n,b:e,match:!1}}function F(r,n,t){let e;if(r&&(e=new Map(Object.entries(r))),n==="")throw new Error("scopie-106 in scopes@0: scope was empty");if(t==="")throw new Error("scopie-106 in actor@0: scope was empty");let c=!1,f=0,i=0;for(;i<t.length;){let o=t[i]==="a";if(o&&c){i=h(t,i,s);continue}i=h(t,i,u),f=i;let l=0;for(;l<n.length;){let $=z(t,i,n,l,e);if($.match){i=$.a,l=$.b;let m=i>=t.length||t[i-1]===s,y=l>=n.length||n[l-1]===s;if(m&&y){if(o)c=!0,i=h(t,i,s);else return!1;break}else if(m!==y)break}else l=h(n,l,s),i=f}i=h(t,i,s)}return c}function P(r){if(r==="")return new Error("scopie-106@0: scope was empty");let n=!1;for(let t=0;t<r.length;t+=1){if(r[t]===u){n=!1;continue}if(r[t]===p){n=!0;continue}if(n){if(r[t]===w&&t<r.length-1&&r[t+1]===w)return new Error(`scopie-103@${t}: super wildcard found in array block`);if(r[t]===w)return new Error(`scopie-102@${t}: wildcard found in array block`);if(r[t]===g){let e=C(r,t);return new Error(`scopie-101@${t}: variable '${r.substring(t+1,e)}' found in array block`)}}if(!k(r[t]))return new Error(`scopie-100@${t}: invalid character '${r[t]}'`);if(r[t]===w&&t<r.length-1&&r[t+1]===w&&t<r.length-2&&r[t+2]!==s)return new Error(`scopie-105@${t}: super wildcard not in the last block`)}}0&&(module.exports={arraySeperator,blockSeperator,isAllowed,scopeSeperator,validateScope,varPrefix,wildcard});
