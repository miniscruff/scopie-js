var k=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var E=Object.getOwnPropertyNames;var O=Object.prototype.hasOwnProperty;var a=(r,i)=>{for(var t in i)k(r,t,{get:i[t],enumerable:!0})},j=(r,i,t,e)=>{if(i&&typeof i=="object"||typeof i=="function")for(let c of E(i))!O.call(r,c)&&c!==t&&k(r,c,{get:()=>i[c],enumerable:!(e=A(i,c))||e.enumerable});return r};var B=r=>j(k({},"__esModule",{value:!0}),r);var R={};a(R,{arraySeperator:()=>p,blockSeperator:()=>g,isAllowed:()=>M,scopeSeperator:()=>s,validateScope:()=>v,varPrefix:()=>u,version:()=>C,wildcard:()=>l});module.exports=B(R);var C="0.1.0",s=",",p="|",g="/",l="*",u="@";function M(r,i,t){let e;if(r&&(e=new Map(Object.entries(r))),i==="")throw"scopie-106 in scopes@0: scope was empty";if(t==="")throw"scopie-106 in actor@0: scope was empty";let c=!1,f=0,n=0;for(;n<t.length;){let o=t[n]==="a";if(o&&c){n=w(t,n,s);continue}n=w(t,n,g),f=n;let h=0;for(;h<i.length;){let $=z(t,n,i,h,e);if($.match){n=$.a,h=$.b;let y=n>=t.length||t[n-1]===s,b=h>=i.length||i[h-1]===s;if(y&&b){if(o)c=!0,n=w(t,n,s);else return!1;break}else if(y!==b)break}else h=w(i,h,s),n=f}n=w(t,n,s)}return c}function v(r){if(r==="")return new Error("scopie-106@0: scope was empty");let i=!1;for(let t=0;t<r.length;t++){if(r[t]===g){i=!1;continue}if(r[t]===p){i=!0;continue}if(i){if(r[t]===l&&t<r.length-1&&r[t+1]===l)return new Error(`scopie-103@${t}: super wildcard found in array block`);if(r[t]===l)return new Error(`scopie-102@${t}: wildcard found in array block`);if(r[t]===u){let e=F(r,t);return new Error(`scopie-101@${t}: variable '${r.substring(t+1,e)}' found in array block`)}}if(!d(r[t]))return new Error(`scopie-100@${t}: invalid character '${r[t]}'`);if(r[t]===l&&t<r.length-1&&r[t+1]===l&&t<r.length-2&&r[t+2]!=s)return new Error(`scopie-105@${t}: super wildcard not in the last block`)}}function z(r,i,t,e,c){if(r[i]===l&&i<r.length-1&&r[i+1]===l){if(i+2<r.length&&r[i+2]!=s)throw`scopie-105 in actor@${i}: super wildcard not in the last block`;return{a:w(r,i,s),b:w(t,e,s),match:!0}}if(r[i]===l)return{a:w(r,i,g),b:w(t,e,g),match:!0};let f=e;for(;f<t.length&&!(t[f]===g||t[f]===s);f++)if(!d(t[f]))throw`scopie-100 in scopes@${f}: invalid character '${t[f]}'`;let n=i,o=i,h=!1;for(;o<r.length;o++){if(r[o]===g||r[o]===s)return m(r,n,o,t,e,f,c)?{a:o+1,b:f+1,match:!0}:{a:i,b:e,match:!1};if(r[o]===p){if(h=!0,r[n]===u)throw`scopie-101 in actor@${n}: variable '${r.substring(n+1,o)}' found in array block`;if(r[n]===l)throw n<r.length-1&&r[n+1]===l?`scopie-103 in actor@${n}: super wildcard found in array block`:`scopie-102 in actor@${n}: wildcard found in array block`;if(m(r,n,o,t,e,f,void 0))return{a:P(r,o),b:f+1,match:!0};n=o+1,o+=1}else if(!d(r[o]))throw`scopie-100 in actor@${o}: invalid character '${r[o]}'`}if(h){if(r[n]===u)throw`scopie-101 in actor@${n}: variable '${r.substring(n+1,o)}' found in array block`;if(r[n]===l)throw n<r.length-1&&r[n+1]===l?`scopie-103 in actor@${n}: super wildcard found in array block`:`scopie-102 in actor@${n}: wildcard found in array block`}return m(r,n,o,t,e,f,c)?{a:o+1,b:f+1,match:!0}:{a:i,b:e,match:!1}}function m(r,i,t,e,c,f,n){if(r[i]===u){let o=r.substring(i+1,t);if(!n.has(o))throw`scopie-104 in actor@${i}: variable '${o}' not found`;return n.get(o)===e.substring(c,f)}return t-i!=f-c?!1:r.substring(i,t)===e.substring(c,f)}function F(r,i){for(let t=i+1;t<r.length;t++)if(r[t]==g||r[t]==s||r[t]==p)return t;return r.length}function w(r,i,t){for(let e=i+1;e<r.length;e++)if(r[e]===t)return e+1;return r.length}function P(r,i){for(let t=i+1;t<r.length;t++)if(r[t]===g||r[t]===s)return t+1;return r.length}function d(r){return r>="a"&&r<="z"||r>="A"&&r<="Z"||r>="0"&&r<="9"?!0:r==="_"||r==="-"||r===u||r===l}0&&(module.exports={arraySeperator,blockSeperator,isAllowed,scopeSeperator,validateScope,varPrefix,version,wildcard});
