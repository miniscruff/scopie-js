var f=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var k=Object.getOwnPropertyNames;var x=Object.prototype.hasOwnProperty;var A=(t,r)=>{for(var n in r)f(t,n,{get:r[n],enumerable:!0})},P=(t,r,n,e)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of k(r))!x.call(t,o)&&o!==n&&f(t,o,{get:()=>r[o],enumerable:!(e=E(r,o))||e.enumerable});return t};var $=t=>P(f({},"__esModule",{value:!0}),t);var j={};A(j,{allowGrant:()=>h,arraySeparator:()=>S,blockSeparator:()=>v,denyGrant:()=>g,isAllowed:()=>I,validateActions:()=>M,validatePermissions:()=>W,varPrefix:()=>O,wildcard:()=>B});module.exports=$(j);var S="|",v="/",B="*",O="@",h="allow",g="deny";function s(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"||t>="0"&&t<="9"?!0:t==="_"||t==="-"}function p(t){return s(t)||t==="@"||t==="*"}function y(t,r){for(let n=r+1;n<t.length;n+=1)if(t[n]==="/"||t[n]==="|")return n;return t.length}function b(t){if(t.startsWith(g))return 5;if(t.startsWith(h))return 6;throw new Error("scopie-107: permission does not start with a grant")}function d(t,r,n){for(let e=n;e<r.length;e+=1){if(r[e]==="/")return e;if(r[e]!=="|"&&!p(r[e]))throw new Error(`scopie-100 in ${t}: invalid character '${r[e]}'`)}return r.length}function V(t,r,n,e,o,a,l){if(t[r]==="@"){let i=t.substring(r+1,n);if(!l.has(i))throw new Error(`scopie-104: variable '${i}' not found`);return l.get(i)===e.substring(o,a)}if(n-r===1&&t[r]==="*")return!0;if(t.substring(r,n).indexOf("|")>=0){for(;r<n;){let i=y(t,r);if(t[r]==="@")throw new Error(`scopie-101: variable '${t.substring(r+1,i)}' found in array block`);if(t[r]==="*")throw i-r>1&&t[r+1]==="*"?new Error("scopie-103: super wildcard found in array block"):new Error("scopie-102: wildcard found in array block");if(t.substring(r,i)===e.substring(o,a))return!0;r=i+1}return!1}return t.substring(r,n)===e.substring(o,a)}function G(t,r,n){let e=b(r),o=0,a=0,l=0;for(;e<r.length||o<t.length;){if(e<r.length!=o<t.length)return!1;if(l=d("action",t,o),a=d("permission",r,e),a-e===2&&r[e]==="*"&&r[e+1]==="*"){if(r.length>a)throw new Error("scopie-105: super wildcard not in the last block");return!0}if(!V(r,e,a,t,o,l,n))return!1;o=l+1,e=a+1}return!0}function I(t,r,n){if(r.length===0)return!1;if(t.length===0)throw new Error("scopie-106 in action: actions was empty");let e;n&&(e=new Map(Object.entries(n)));let o=!1;for(let a=0;a<r.length;a+=1){let l=r[a];if(l.length===0)throw new Error("scopie-106 in permission: permission was empty");let i=l[0]==="a";if(!(i&&o))for(let c=0;c<t.length;c+=1){let u=t[c];if(u.length===0)throw new Error("scopie-106 in action: action was empty");let w=G(u,l,e);if(w&&i)o=!0;else if(w&&!i)return!1}}return o}function M(t){if(t.length===0)return new Error("scopie-106: action array was empty");for(let r of t){if(r.length===0)return new Error("scopie-106: action was empty");for(let n=0;n<r.length;n+=1)if(!s(r[n])&&r[n]!=="/")return new Error(`scopie-100: invalid character '${r[n]}'`)}}function W(t){if(t.length===0)return new Error("scopie-106: permission array was empty");for(let r of t){if(r.length===0)return new Error("scopie-106: permission was empty");let n=!1,e=0;try{e=b(r)}catch(o){return o}for(;e<r.length;e+=1){if(r[e]==="/"){n=!1;continue}if(r[e]==="|"){n=!0;continue}if(n){if(r[e]==="*"&&e<r.length-1&&r[e+1]==="*")return new Error("scopie-103: super wildcard found in array block");if(r[e]==="*")return new Error("scopie-102: wildcard found in array block");if(r[e]==="@"){let o=y(r,e);return new Error(`scopie-101: variable '${r.substring(e+1,o)}' found in array block`)}}if(!p(r[e]))return new Error(`scopie-100: invalid character '${r[e]}'`);if(r[e]==="*"&&e<r.length-1&&r[e+1]==="*"&&e<r.length-2)return new Error("scopie-105: super wildcard not in the last block")}}}0&&(module.exports={allowGrant,arraySeparator,blockSeparator,denyGrant,isAllowed,validateActions,validatePermissions,varPrefix,wildcard});
