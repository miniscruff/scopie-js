var u=Object.defineProperty;var x=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var A=Object.prototype.hasOwnProperty;var $=(r,n)=>{for(var t in n)u(r,t,{get:n[t],enumerable:!0})},B=(r,n,t,o)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of m(n))!A.call(r,i)&&i!==t&&u(r,i,{get:()=>n[i],enumerable:!(o=x(n,i))||o.enumerable});return r};var W=r=>B(u({},"__esModule",{value:!0}),r);var j={};$(j,{allowPermission:()=>h,arraySeperator:()=>l,blockSeperator:()=>p,denyPermission:()=>g,isAllowed:()=>I,validateScopes:()=>M,varPrefix:()=>f,wildcard:()=>a});module.exports=W(j);var l="|",p="/",a="*",f="@",h="allow",g="deny";function E(r){return r>="a"&&r<="z"||r>="A"&&r<="Z"||r>="0"&&r<="9"?!0:r==="_"||r==="-"||r===f||r===a}function k(r,n){for(let t=n+1;t<r.length;t+=1)if(r[t]===p||r[t]===l)return t;return r.length}function d(r,n,t){for(let o=t;o<n.length;o+=1){if(n[o]===p)return o;if(n[o]!==l&&!E(n[o]))throw new Error(`scopie-100 in ${r}: invalid character '${n[o]}'`)}return n.length}function P(r,n,t,o,i,e,s){if(r[n]===f){let c=r.substring(n+1,t);if(!s.has(c))throw new Error(`scopie-104: variable '${c}' not found`);return s.get(c)===o.substring(i,e)}if(t-n===1&&r[n]===a)return!0;if(r.substring(n,t).indexOf(l)>=0){for(;n<t;){let c=k(r,n);if(r[n]===f)throw new Error(`scopie-101: variable '${r.substring(n+1,c)}' found in array block`);if(r[n]===a)throw c-n>1&&r[n+1]===a?new Error("scopie-103: super wildcard found in array block"):new Error("scopie-102: wildcard found in array block");if(r.substring(n,c)===o.substring(i,e))return!0;n=c+1}return!1}return r.substring(n,t)===o.substring(i,e)}function V(r,n,t){let o=d("rule",n,0)+1,i=0,e=0,s=0;for(;o<n.length||i<r.length;){if(o<n.length!=i<r.length)return!1;if(s=d("scope",r,i),e=d("rule",n,o),e-o===2&&n[o]===a&&n[o+1]===a){if(n.length>e)throw new Error("scopie-105: super wildcard not in the last block");return!0}if(!P(n,o,e,r,i,s,t))return!1;i=s+1,o=e+1}return!0}function I(r,n,t){if(n.length===0)return!1;if(r.length===0)throw new Error("scopie-106 in scope: scopes was empty");let o;t&&(o=new Map(Object.entries(t)));let i=!1;for(let e=0;e<n.length;e+=1){let s=n[e];if(s.length===0)throw new Error("scopie-106 in rule: rule was empty");let c=s[0]==="a";if(!(c&&i))for(let w=0;w<r.length;w+=1){let b=r[w];if(b.length===0)throw new Error("scopie-106 in scope: scope was empty");let y=V(b,s,o);if(y&&c)i=!0;else if(y&&!c)return!1}}return i}function M(r){if(r.length===0)return new Error("scopie-106: scopes are empty");let n=r[0].startsWith(h)||r[0].startsWith(g);for(let t of r){if(t.length===0)return new Error("scopie-106: scope or rule was empty");let o=t.startsWith(h)||t.startsWith(g);if(n!=o)return new Error("scopie-107: inconsistent array of scopes and rules");let i=!1;for(let e=0;e<t.length;e+=1){if(t[e]===p){i=!1;continue}if(t[e]===l){i=!0;continue}if(i){if(t[e]===a&&e<t.length-1&&t[e+1]===a)return new Error("scopie-103: super wildcard found in array block");if(t[e]===a)return new Error("scopie-102: wildcard found in array block");if(t[e]===f){let s=k(t,e);return new Error(`scopie-101: variable '${t.substring(e+1,s)}' found in array block`)}}if(!E(t[e]))return new Error(`scopie-100: invalid character '${t[e]}'`);if(t[e]===a&&e<t.length-1&&t[e+1]===a&&e<t.length-2)return new Error("scopie-105: super wildcard not in the last block")}}}0&&(module.exports={allowPermission,arraySeperator,blockSeperator,denyPermission,isAllowed,validateScopes,varPrefix,wildcard});
